<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eric Li • Thoughts</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<!-- Cormorant Garamond -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Cormorant Garamond',serif;
  color:#444;
  line-height:1.45;
}
/* fixed clock (mirrors home page) */
#clock{
  position:fixed;
  top:15px;right:28px;
  font:400 18px 'Cormorant Garamond',serif;
}
/* page scaffold – centre any prose you add later */
main{max-width:680px;margin:100px auto 0;padding:0 24px;text-align:left}
</style>
</head>

<body>
<!-- Eastern-time clock -->
<time id="clock" aria-label="Current time" datetime=""></time>

<main>
  <h1 style="font-weight:400;font-size:46px;margin-bottom:40px">Thoughts</h1>
  <!-- essays / posts go here -->
</main>

<!-- clock script -->
<script>
const clk=document.getElementById('clock');
function tick(){
  const now=new Date();
  clk.textContent=new Intl.DateTimeFormat('en-US',{
    timeZone:'America/New_York',
    hour12:false,
    hour:'2-digit',minute:'2-digit',second:'2-digit'
  }).format(now);
  clk.dateTime=now.toISOString();
}
tick();
setInterval(tick,1000);
</script>

<!-- favicon sparkline -->
<script>
/* ---------- canvas & link setup ---------- */
const icon=document.createElement('link');
icon.rel='icon';
icon.type='image/png';
icon.sizes='16x16';
document.head.appendChild(icon);

const cvs=document.createElement('canvas');
cvs.width=cvs.height=16;
const ctx=cvs.getContext('2d');

/* ---------- sparkline state ---------- */
const LEN=20;               // points in tape
let tape=[];                // price series (may start as random)
let seeded=false;           // true = placeholder, false = real

/* ---------- helpers ---------- */
async function fetchPrice(){
  const r=await fetch('https://api.coinbase.com/v2/prices/ETH-USD/spot');
  return +((await r.json()).data.amount);
}

function randomWalk(base){
  const out=[]; const vol=base*0.005; let v=base;
  for(let i=0;i<LEN;i++){ v+= (Math.random()*2-1)*vol; out.push(v); }
  return out;
}

function draw(){
  const hi=Math.max(...tape), lo=Math.min(...tape)||1;
  ctx.clearRect(0,0,16,16);
  ctx.beginPath();
  tape.forEach((v,i)=>{
    const x=i*16/(LEN-1);
    const y=15-((v-lo)/(hi-lo))*15;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  const diff=tape[LEN-1]-tape[LEN-2]||0;
  ctx.strokeStyle=diff>0?'#0a0':diff<0?'#c00':'#555';
  ctx.lineWidth=1;
  ctx.stroke();
  icon.href=cvs.toDataURL('image/png');
}

/* ---------- main updater ---------- */
async function update(){
  try{
    const price=await fetchPrice();

    /* first successful fetch: wipe any fake data */
    if(seeded){
      tape=Array(LEN).fill(price);
      seeded=false;
    }else if(!tape.length){
      tape=Array(LEN).fill(price);     // instant flat start
    }else{
      tape.push(price); tape.shift();
    }

    draw();
    document.title=`Ξ ${Math.round(price).toLocaleString('en-US')} USD`;
    return true;                      // success
  }catch{
    if(!tape.length){                 // first call failed → seed placeholder
      tape=randomWalk(3000);
      seeded=true;
      draw();
    }
    console.warn('price fetch failed');
    return false;                     // failure
  }
}

/* ---------- polling logic ---------- */
(async()=>{
  let ok=await update();
  if(!ok){                            // aggressive retry until first success
    const fast=setInterval(async()=>{
      ok=await update();
      if(ok){ clearInterval(fast); setInterval(update,30_000); }
    },5000);                          // every 5 s
  }else{
    setInterval(update,30_000);       // first try already succeeded
  }
})();
</script>
</body>
</html>
