<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ξ —</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Cormorant Garamond -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&display=swap" rel="stylesheet">

  <link rel="preload" as="image"
        href="https://ids.si.edu/ids/deliveryService?id=SAAM-1967.107.2_1&max=960">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    :root{
      --ink:#000;
      --stack:680px;
      --top:35px;
    }

    body{
      font-family:'Cormorant Garamond',serif;
      color:var(--ink);
      text-align:center;
      line-height:1.45;
      opacity:0;
      animation:fade .4s ease forwards;
      animation-fill-mode:forwards;
    }

    main{
      width:var(--stack);
      margin:var(--top) auto 0;
    }

    #hero{
      width:129px;height:190px;
      object-fit:cover;
      display:block;
      margin:0 auto 5px;
    }

    h1{font-weight:400;font-size:32px;margin-bottom:8px}

    #links{
      display:flex;
      justify-content:center;
      gap:2em;
      font-size:16px;
      font-weight:400;
      margin-bottom:15px;
    }

    .divider{
      width:70%;
      margin:6px auto 0;
      border:none;border-top:1px solid var(--ink);
    }

    /* clock */
    #clock{
      position:fixed;top:12px;right:16px;
      font:400 16px 'Cormorant Garamond',serif;
      color:var(--ink);
    }

    /* floating quote container */
    #ticker{
      position:fixed;inset:0;pointer-events:none;
      z-index:5;
    }
    .quote{
      position:fixed;
      font:300 16px 'Cormorant Garamond',serif;
      color:var(--ink);
      animation:fadeCycle 6s ease-in-out forwards;
      white-space:nowrap;
      user-select:none;
    }

    @keyframes fade{to{opacity:1}}

    @keyframes fadeCycle{
      0%   {opacity:0;transform:translateY(6px) scale(.94)}
      15%  {opacity:1;transform:translateY(0)  scale(1)}
      70%  {opacity:1}
      100% {opacity:0;transform:translateY(-6px) scale(1.04)}
    }

    h1 a,#links a{color:var(--ink)!important;text-decoration:none!important}
  </style>
</head>
<body>
  <time id="clock" aria-label="Current time" datetime=""></time>

  <main>
    <img id="hero"
         src="https://ids.si.edu/ids/deliveryService?id=SAAM-1967.107.2_1&max=960"
         alt="Louis Lozowick, New York (1923)">
    <h1>
      <a href="https://www.linkedin.com/in/eric-li-226850249/"
         target="_blank" rel="noopener">Eric Li</a>
    </h1>
    <div id="links">
      <a href="thoughts.html">Thoughts</a>
      <a href="mailto:eric_li1@college.harvard.edu">Contact</a>
    </div>
    <hr class="divider">
    <div id="ticker" aria-hidden="true"></div>
  </main>

  <!-- live clock -->
  <script>
    const clk=document.getElementById('clock');
    function tick(){
      const now=new Date();
      clk.textContent=new Intl.DateTimeFormat('en-US',{
        timeZone:'America/New_York',
        hour12:false,
        hour:'2-digit',minute:'2-digit',second:'2-digit'
      }).format(now);
      clk.dateTime=now.toISOString();
    }
    tick();
    let tickTimer=setInterval(tick,1000);
  </script>

  <!-- favicon sparkline -->
  <script>
    (function(){
      const icon=document.createElement('link');
      icon.rel='icon';icon.type='image/png';icon.sizes='16x16';
      document.head.appendChild(icon);

      const cvs=document.createElement('canvas');
      cvs.width=cvs.height=16;
      const ctx=cvs.getContext('2d');

      const LEN=20;
      let tape=[];let seeded=true;let priceTimer;

      async function fetchPrice(){
        try{
          const r=await fetch('https://api.coinbase.com/v2/prices/ETH-USD/spot');
          if(!r.ok)throw 0;
          return+((await r.json()).data.amount);
        }catch{return null;}
      }

      function randomWalk(b){
        const a=[],vol=b*0.005;let v=b;
        for(let i=0;i<LEN;i++){v+=(Math.random()*2-1)*vol;a.push(v);}
        return a;
      }

      function draw(){
        const hi=Math.max(...tape),lo=Math.min(...tape)||1;
        ctx.clearRect(0,0,16,16);ctx.beginPath();
        tape.forEach((v,i)=>{
          const x=i*16/(LEN-1);
          const y=15-((v-lo)/(hi-lo))*15;
          i?ctx.lineTo(x,y):ctx.moveTo(x,y);
        });
        const change=seeded?tape[LEN-1]-tape[0]:tape[LEN-1]-tape[LEN-2];
        ctx.strokeStyle=change>0?'#0a0':change<0?'#c00':'#555';
        ctx.lineWidth=1;ctx.stroke();
        icon.href=cvs.toDataURL('image/png');
      }

      async function update(){
        const p=await fetchPrice();
        if(p!==null){
          document.title=`Ξ ${Math.round(p).toLocaleString('en-US')} USD`;
          if(seeded){tape=Array(LEN).fill(p);seeded=false;}
          else{tape.push(p);tape.shift();}
          draw();
        }
      }

      (async()=>{
        const start=await fetchPrice();
        document.title=start?`Ξ ${Math.round(start).toLocaleString('en-US')} USD`:'Ξ —';
        tape=randomWalk(start||3500);draw();
        priceTimer=setInterval(update,30000);
      })();

      document.addEventListener('visibilitychange',()=>{
        if(document.hidden){clearInterval(tickTimer);clearInterval(priceTimer);}
        else{
          tick();tickTimer=setInterval(tick,1000);
          update();priceTimer=setInterval(update,30000);
        }
      });
    })();
  </script>

  <!-- floating random-price quotes -->
  <script>
    (function(){
      const box=document.getElementById('ticker');
      let coins=[];const excluded=/usd|usdt|usdc|busd|dai|usdp|usdd|tusd|fdusd/i;
      const fmt=n=>n.toLocaleString('en-US',{style:'currency',currency:'USD',maximumFractionDigits:2});

      async function loadTop25(){
        try{
          const r=await fetch(
            'https://api.coingecko.com/api/v3/coins/markets' +
            '?vs_currency=usd&order=market_cap_desc&per_page=25&page=1&sparkline=false'
          );
          if(!r.ok)throw 0;
          coins=(await r.json())
            .filter(c=>!excluded.test(c.symbol))      // drop stablecoins
            .map(c=>({id:c.id,sym:c.symbol.toUpperCase()}));
        }catch{
          coins=[{id:'bitcoin',sym:'BTC'},{id:'ethereum',sym:'ETH'}];
        }
      }

      async function price(id){
        const r=await fetch(
          `https://api.coingecko.com/api/v3/simple/price?ids=${id}&vs_currencies=usd`
        );
        if(!r.ok)throw 0;
        return (await r.json())[id].usd;
      }

      function spot(){
        const vw=window.innerWidth,vh=window.innerHeight;
        const safeLeft=(vw-680)/2-80,safeRight=(vw+680)/2+80;
        let x,y;
        do{
          x=Math.random()*(vw-140);   // leave ~140px buffer for text width
        }while(x>safeLeft&&x<safeRight);
        y=60+Math.random()*(vh-120);  // avoid clock/top edge
        return {x,y};
      }

      async function drop(){
        if(!coins.length)await loadTop25();
        const pick=coins[Math.floor(Math.random()*coins.length)];
        try{
          const p=await price(pick.id);
          const node=document.createElement('span');
          node.className='quote';
          node.textContent=`${pick.sym} ${fmt(p)}`;
          const pos=spot();
          node.style.left=`${pos.x}px`;node.style.top=`${pos.y}px`;
          box.appendChild(node);
          setTimeout(()=>node.remove(),6000);
        }catch(e){console.error(e);}
        setTimeout(drop,6000);
      }
      drop();
    })();
  </script>
</body>
</html>
