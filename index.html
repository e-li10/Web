<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Eric Li</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

  <!-- Site styles -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Eric Li</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/thoughts">Thoughts</a>
    </nav>
  </header>

  <!-- Block Pulse canvas -->
  <canvas id="pulse" height="180"></canvas>

  <!-- Live Eastern-Time clock -->
  <div id="clock"></div>

  <script>
    // ───── CLOCK ─────
    const updateClock = () =>
      document.getElementById('clock').textContent =
        new Intl.DateTimeFormat('en-US',{
          timeZone:'America/New_York',
          hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'
        }).format(new Date());
    updateClock();
    setInterval(updateClock,1000);

    // ───── BLOCK PULSE (WebSocket) ─────
    (function(){
      const canvas = document.getElementById('pulse');
      const ctx    = canvas.getContext('2d');
      const WS_URL = 'wss://mainnet.infura.io/ws/v3/efcbcda2cca54180b0f7e3007df3a348';

      function resize() {
        canvas.width  = innerWidth * 0.8 | 0;
        canvas.height = 180;
      }
      window.addEventListener('resize', resize);
      resize();

      // render a wavy line from 64-char hex
      function render(hex) {
        const bytes = hex.match(/../g).map(h => parseInt(h,16));
        const { width:w, height:h0 } = canvas;
        ctx.clearRect(0,0,w,h0);
        ctx.beginPath();
        ctx.moveTo(0, h0/2);
        bytes.forEach((b,i) => {
          ctx.lineTo(i/32 * w, h0/2 + (b - 128)*0.8);
        });
        ctx.strokeStyle = '#111';
        ctx.lineWidth   = 2.5;
        ctx.stroke();
      }

      function randomHex() {
        return crypto.getRandomValues(new Uint32Array(16))
          .reduce((s,n) => s + n.toString(16).padStart(8,'0'), '');
      }

      let ws;
      function connect() {
        ws = new WebSocket(WS_URL);
        ws.onopen = () => {
          ws.send(JSON.stringify({
            jsonrpc:'2.0',id:1,
            method:'eth_subscribe',
            params:['newHeads']
          }));
        };
        ws.onmessage = msg => {
          const data = JSON.parse(msg.data);
          if (data.params?.result?.hash) {
            render(data.params.result.hash.slice(2));
          }
        };
        ws.onerror = ws.onclose = () => {
          setTimeout(connect,2000);
          render(randomHex());
        };
      }
      connect();
    })();
  </script>
</body>
</html>
